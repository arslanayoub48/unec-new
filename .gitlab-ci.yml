stages:
  - deploy
  - clear

.build: &build_tpl
  image: docker:latest
  services:
  - docker:dind


deploy:
  <<: *build_tpl
  stage: deploy
  script:
    - mkdir /home/Unec
    - cd /home/Unec
    - apt update 
    - apt install git
    - git pull https://gitlab.com/pektiyaz/unec-new.git master 
    - cd docker
    - docker-compose up -d

clear:
  <<: *build_tpl
  stage: clear
  script:
    - cd /home/Unec/docker
    - docker-compose app exec php artisan config:cache
    - docker image prune -a -f

